!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).BufferedEventEmitter={})}(this,(function(e){"use strict";var t,i,s=function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function u(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(u,r)}l((s=s.apply(e,t||[])).next())}))},n=function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)};class o{constructor(e,t,i){this.fn=e,this.once=t,this.options=i,(null==i?void 0:i.buffered)&&(this.bucket=[],this.timeoutID=void 0)}}class u{constructor(e){var i,s;t.add(this),this._events={},this._defaultListenerOptions={buffered:null!==(i=null==e?void 0:e.buffered)&&void 0!==i&&i,bufferCapacity:null!==(s=null==e?void 0:e.bufferCapacity)&&void 0!==s?s:5},this._status="emitting",this._shouldQueueEmissions=!0,this._emissionInterval=0,this._queue=[]}emit(e,t){if(!this._events[e]||0===this._events[e].length)return!1;if("paused"===this._status)return this._shouldQueueEmissions&&this._queue.push({eventName:e,data:t}),!1;let i=[],s=!1;return this._events[e].forEach((n=>{var o,u;let r=!1;if(n.options.buffered){null===(o=null==n?void 0:n.bucket)||void 0===o||o.push(t);const i=null!==(u=n.options.bufferCapacity)&&void 0!==u?u:this._defaultListenerOptions.bufferCapacity;(null==n?void 0:n.bucket)&&n.bucket.length>=i&&(n.fn(n.bucket),r=!0,s=!0,this.logger("emit",e,n.bucket),n.bucket=[])}else n.fn(t),r=!0,s=!0,this.logger("emit",e,t);n.once&&r||i.push(n)})),this._events[e]=i,s}on(e,t,i={}){return this._events[e]||(this._events[e]=[]),-1===l(this._events[e],t,i)&&(this._events[e].push(new o(t,!1,i)),this.logger("subscribe",e,t),!0)}once(e,t,i={}){return this._events[e]||(this._events[e]=[]),-1===l(this._events[e],t,i)&&(this._events[e].push(new o(t,!0,i)),this.logger("subscribe",e,t),!0)}removeListener(e,t,i={}){let s=l(this._events[e],t,i);return-1!==s&&(this._events[e].splice(s,1),!0)}flush(e,t,i){let s=!1,n=[];return this._events[e].forEach(((o,u)=>{if(o.options.buffered&&(null==o?void 0:o.bucket)&&o.bucket.length>0){const l=t&&t===o.fn,h=i&&r(i,o.options);(e&&l&&h||e&&!t&&!i)&&(o.fn(o.bucket),s=!0,this.logger("emit",e,o.bucket),o.bucket=[],o.once&&n.push(u))}})),this._events[e]=this._events[e].filter(((e,t)=>!n.includes(t))),s}pause(e=!0,t=0){this._shouldQueueEmissions=e,this._emissionInterval=t,this._status="paused"}resume(){if(this._status="emitting",this._shouldQueueEmissions){if(this._emissionInterval>0){return(()=>s(this,void 0,void 0,(function*(){console.log("queue",this._queue);for(const e of this._queue)yield n(this,t,"m",i).call(this,e,this._emissionInterval)})))()}this._queue.forEach((({eventName:e,data:t})=>{this.emit(e,t)})),this._queue=[]}}listeners(e){return void 0===e?this._events:this._events[e].map((e=>e.fn))}addListener(e,t,i={}){return this.on(e,t,i)}off(e,t,i={}){return this.removeListener(e,t,i)}logger(e,t,i){if("emit"===e&&!u.debugEnabled.logEmit||"subscribe"===e&&!u.debugEnabled.logSubscribe)return;if("emit"===e)try{i=JSON.stringify(i)}catch(e){i=`Object with the following keys failed to stringify: ${Object.keys(i).join(",")}`}else"subscribe"===e&&"function"==typeof i&&(i=i.toString());const s=new Date,n=`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}.${s.getMilliseconds()}`;console.groupCollapsed(`%c[Event Type: ${e} | Event Name: ${t} | ${n}]`,"color: blue; font-size: 12px"),console.log(`%c[Event Data: ${i}}]`,"color: #AD5D4E; font-size: 11px"),console.groupEnd()}static enableDebug(e,t){void 0===e&&void 0===t&&(this.debugEnabled={logEmit:!0,logSubscribe:!0}),void 0!==e&&(this.debugEnabled=Object.assign(Object.assign({},this.debugEnabled),{logEmit:e})),void 0!==t&&(this.debugEnabled=Object.assign(Object.assign({},this.debugEnabled),{logSubscribe:t}))}}function r(e,t){if(!e||!t)return!1;const i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;let n;for(n in e)if(e[n]!==t[n])return!1;return!0}function l(e,t,i){for(let s=0;s<e.length;s++)if(e[s].fn===t&&r(e[s].options,i))return s;return-1}t=new WeakSet,i=function(e,t){let i;return new Promise((s=>i=setTimeout((()=>{this.emit(e.eventName,e.data),s(!0)}),t))).finally((()=>{clearTimeout(i)}))},u.debugEnabled={logEmit:!1,logSubscribe:!1},e.BufferedEventEmitter=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=bundle.umd.min.js.map
