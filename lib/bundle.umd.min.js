!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["buffered-event-emitter"]={})}(this,(function(t){"use strict";const e=!0,i=`__all-${Date.now()}`,s="0",o="1";class n{name;fn;once;options;bucket;bufferInactivityTimeoutId;constructor(t,e,i,s){this.name=t,this.fn=e,this.once=i,this.options=s,s?.buffered&&(this.bucket=[],this.bufferInactivityTimeoutId=void 0)}}class f{name;shouldQ;interval;status;constructor(t,e,i,s){this.name=t,this.status=e,this.shouldQ=i,this.interval=s}updateProps({status:t,shouldQ:e,interval:i}){t&&(this.status=t),void 0!==e&&(this.shouldQ=e),void 0!==i&&(this.interval=i)}getProps(){return{status:this.status,shouldQ:this.shouldQ,interval:this.interval,name:this.name}}}function u(t,e){if(t===e)return!0;if(!t||!e)return!1;const i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;let o;for(o in t)if(t[o]!==e[o])return!1;return!0}function r(t,e,i){for(let s=0;s<t.length;s++)if(t[s].fn===e&&u(t[s].options,i))return s;return-1}function c(t,e){let i;return new Promise((s=>i=setTimeout((()=>{this.emit(t.name,t.data),s(!0)}),e))).finally((()=>{clearTimeout(i)}))}let h={emit:!1,on:!1,off:!1};function a(t,e,i){if("emit"===t&&!h.emit||"on"===t&&!h.on||"off"===t&&!h.off)return;if("emit"===t)try{i=JSON.stringify(i)}catch{i=`Object with the following keys failed to stringify: ${Object.keys(i).join(",")}`}else["on","off"].includes(t)&&"function"==typeof i&&(i=i.toString());const s=new Date,o=`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}.${s.getMilliseconds()}`;console.groupCollapsed(`%c[Event Type: ${t} | Event Name: ${e} | ${o}]`,"color: blue; font-size: 12px"),console.log(`%c[Event Data: ${i}}]`,"color: #AD5D4E; font-size: 11px"),console.groupEnd()}class l{flush(){}off(){}}const v=new Map;function p(t,e){const i=v.get(t)||[];i.push(e),v.set(t,i),t.off=()=>{i.forEach((t=>{this.off(t.name,t.fn,t.options)}))},t.flush=()=>{i.forEach((t=>{this.flush(t.name,t.fn,t.options)}))}}class d{_evts;_opts;_pEvtsConf;_pEvtsQ;_cache;constructor(t){this._evts={},this._opts={buffered:t?.buffered??false,bufferCapacity:t?.bufferCapacity??5,bufferInactivityTimeout:t?.bufferInactivityTimeout??0,logger:t?.logger??a,cache:t?.cache??false,cacheCapacity:t?.cacheCapacity??20},this._pEvtsConf=new Map([[i,new f(i,o,e,0)]]),this._pEvtsQ=[],this._cache=new Map}emit(t,e){if(!this._evts[t]||0===this._evts[t].length)return!1;const o=this._pEvtsConf.get(i)?.status===s,n=this._pEvtsConf.get(t)?.status===s;if(o||n)return(this._pEvtsConf.get(i)?.shouldQ||this._pEvtsConf.get(t)?.shouldQ)&&this._pEvtsQ.push({name:t,data:e}),!1;let f=[],u=!1;return this._evts[t].forEach((i=>{let s=!1;if(i?.options?.buffered){i?.bucket?.push(e);const o=i?.options.bufferCapacity??this._opts.bufferCapacity;if(i?.bucket&&i.bucket.length>=o)i.bufferInactivityTimeoutId&&(clearTimeout(i.bufferInactivityTimeoutId),i.bufferInactivityTimeoutId=void 0),i.fn(i.bucket),_.call(this,t,i.bucket),s=!0,u=!0,this._opts.logger("emit",t,i.bucket),i.bucket=[];else if(i?.bucket&&i.bucket.length>0){const e=i?.options?.bufferInactivityTimeout??this._opts.bufferInactivityTimeout;e>0&&(i.bufferInactivityTimeoutId&&(clearTimeout(i.bufferInactivityTimeoutId),i.bufferInactivityTimeoutId=void 0),i.bufferInactivityTimeoutId=setTimeout((()=>{i?.bucket&&i.bucket.length&&(i.fn(i.bucket),_.call(this,t,i.bucket),this._opts.logger("emit",t,i.bucket),i.bucket=[]),i.bufferInactivityTimeoutId=void 0}),e))}}else i.fn(e),_.call(this,t,e),s=!0,u=!0,this._opts.logger("emit",t,e);i.once&&s||f.push(i)})),this._evts[t]=f,u}on(t,e,i){if(this._evts[t]||(this._evts[t]=[]),-1!==r(this._evts[t],e,i))return!1;const s=new n(t,e,!1,i);return i?.control instanceof l&&p.call(this,i.control,s),this._evts[t].push(s),this._opts.logger("on",t,e),!0}once(t,e,i){if(this._evts[t]||(this._evts[t]=[]),-1!==r(this._evts[t],e,i))return!1;const s=new n(t,e,!0,i);return i?.control instanceof l&&p.call(this,i.control,s),this._evts[t].push(s),this._opts.logger("on",t,e),!0}off(t,e,i){let s=r(this._evts[t],e,i);if(-1===s)return!1;const[o]=this._evts[t].splice(s,1);return o.bufferInactivityTimeoutId&&(clearTimeout(o.bufferInactivityTimeoutId),o.bufferInactivityTimeoutId=void 0),this._opts.logger("off",t,e),!0}flush(t,e,i){let s=!1,o=[];return this._evts[t].forEach(((n,f)=>{if(n?.options?.buffered&&n?.bucket&&n.bucket.length>0){const r=e&&e===n.fn,c=i&&u(i,n.options);(t&&r&&c||t&&!e&&!i)&&(n.bufferInactivityTimeoutId&&(clearTimeout(n.bufferInactivityTimeoutId),n.bufferInactivityTimeoutId=void 0),n.fn(n.bucket),_.call(this,t,n.bucket),s=!0,this._opts.logger("emit",t,n.bucket),n.bucket=[],n.once&&o.push(f))}})),this._evts[t]=this._evts[t].filter(((t,e)=>!o.includes(e))),s}pause(t){const o=t?.queueEmissions??e,n=t?.emissionInterval??0;"string"==typeof t?.eventName?this._pEvtsConf.set(t?.eventName,new f(t?.eventName,s,o,n)):(this._pEvtsConf.size>1&&this._pEvtsConf.clear(),this._pEvtsConf.set(i,new f(i,s,o,n)))}resume(t){let e=[],o=0;if("string"==typeof t){if(this._pEvtsConf.get(t)){const{shouldQ:i,status:n,interval:f}=this._pEvtsConf.get(t).getProps();this._pEvtsConf.delete(t),n===s&&i&&(this._pEvtsQ=this._pEvtsQ.filter((i=>i.name!==t||(e.push(i),!1))),o=f)}}else if(this._pEvtsConf.size>1)o=0,e=this._pEvtsQ,this._pEvtsQ=[];else if(this._pEvtsConf.get(i)){const{shouldQ:t,status:n,interval:f}=this._pEvtsConf.get(i).getProps();this._pEvtsConf.clear(),n===s&&t&&(e=this._pEvtsQ,this._pEvtsQ=[],o=f)}if(o>0){return(async()=>{for(const t of e)await c.call(this,t,o)})()}e.forEach((({name:t,data:e})=>{this.emit(t,e)}))}offAll(t){if(t&&this._evts[t]?.length>0){return this._evts[t].forEach((t=>{t.bufferInactivityTimeoutId&&(clearTimeout(t.bufferInactivityTimeoutId),t.bufferInactivityTimeoutId=void 0)})),delete this._evts[t],this._pEvtsQ=this._pEvtsQ.filter((e=>e.name!==t)),this._pEvtsConf.delete(t),this._cache.delete(t),!0}return!1}cleanup(){this._pEvtsConf.clear(),this._pEvtsQ=[],this._cache.clear(),Object.values(this._evts).forEach((t=>{t.forEach((t=>{t.bufferInactivityTimeoutId&&(clearTimeout(t.bufferInactivityTimeoutId),t.bufferInactivityTimeoutId=void 0)}))})),this._evts={}}listeners(t){return void 0===t?this._evts:this._evts[t].map((t=>t.fn))}getCache(t){return this._cache.get(t)||[]}static enableDebug(t){!function(t){h={...h,...t}}(t)}static get debugStatus(){return h}}function _(t,e){if(!this._opts.cache)return;const i=this._cache.get(t)||[];i.length>=this._opts.cacheCapacity&&i.shift(),i.push(e),this._cache.set(t,i)}d.prototype.addListener=d.prototype.on,d.prototype.removeListener=d.prototype.off,t.BufferedEventEmitter=d,t.EventController=l,Object.defineProperty(t,"__esModule",{value:!0})})),"undefined"!=typeof window&&(window.BufferedEventEmitter=window["buffered-event-emitter"].BufferedEventEmitter,window.EventController=window["buffered-event-emitter"].EventController);
//# sourceMappingURL=bundle.umd.min.js.map
