const t=!0,e=`__all-${Date.now()}`,s="0",i="1";class n{constructor(t,e,s,i){this.name=t,this.fn=e,this.once=s,this.options=i,(null==i?void 0:i.buffered)&&(this.bucket=[],this.timeoutID=void 0)}}class o{constructor(t,e,s,i){this.name=t,this.status=e,this.shouldQ=s,this.interval=i}updateProps({status:t,shouldQ:e,interval:s}){t&&(this.status=t),void 0!==e&&(this.shouldQ=e),void 0!==s&&(this.interval=s)}getProps(){return{status:this.status,shouldQ:this.shouldQ,interval:this.interval,name:this.name}}}function l(t,e){if(t===e)return!0;if(!t||!e)return!1;const s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;let n;for(n in t)if(t[n]!==e[n])return!1;return!0}function u(t,e,s){for(let i=0;i<t.length;i++)if(t[i].fn===e&&l(t[i].options,s))return i;return-1}function h(t,e){let s;return new Promise((i=>s=setTimeout((()=>{this.emit(t.name,t.data),i(!0)}),e))).finally((()=>{clearTimeout(s)}))}let r={emit:!1,on:!1,off:!1};function c(t,e,s){if("emit"===t&&!r.emit||"on"===t&&!r.on||"off"===t&&!r.off)return;if("emit"===t)try{s=JSON.stringify(s)}catch(t){s=`Object with the following keys failed to stringify: ${Object.keys(s).join(",")}`}else["on","off"].includes(t)&&"function"==typeof s&&(s=s.toString());const i=new Date,n=`${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}.${i.getMilliseconds()}`;console.groupCollapsed(`%c[Event Type: ${t} | Event Name: ${e} | ${n}]`,"color: blue; font-size: 12px"),console.log(`%c[Event Data: ${s}}]`,"color: #AD5D4E; font-size: 11px"),console.groupEnd()}class f{flush(){}off(){}}const v=new Map;function a(t,e){const s=v.get(t)||[];s.push(e),v.set(t,s),t.off=()=>{s.forEach((t=>{this.off(t.name,t.fn,t.options)}))},t.flush=()=>{s.forEach((t=>{this.flush(t.name,t.fn,t.options)}))}}var p=function(t,e,s,i){return new(s||(s=Promise))((function(n,o){function l(t){try{h(i.next(t))}catch(t){o(t)}}function u(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(l,u)}h((i=i.apply(t,e||[])).next())}))};class d{constructor(s){var n,l,u,h,r;this._evts={},this._opts={buffered:null!==(n=null==s?void 0:s.buffered)&&void 0!==n&&n,bufferCapacity:null!==(l=null==s?void 0:s.bufferCapacity)&&void 0!==l?l:5,logger:null!==(u=null==s?void 0:s.logger)&&void 0!==u?u:c,cache:null!==(h=null==s?void 0:s.cache)&&void 0!==h&&h,cacheCapacity:null!==(r=null==s?void 0:s.cacheCapacity)&&void 0!==r?r:20},this._pEvtsConf=new Map([[e,new o(e,i,t,0)]]),this._pEvtsQ=[],this._cache=new Map}emit(t,i){var n,o,l,u;if(!this._evts[t]||0===this._evts[t].length)return!1;const h=(null===(n=this._pEvtsConf.get(e))||void 0===n?void 0:n.status)===s,r=(null===(o=this._pEvtsConf.get(t))||void 0===o?void 0:o.status)===s;if(h||r)return((null===(l=this._pEvtsConf.get(e))||void 0===l?void 0:l.shouldQ)||(null===(u=this._pEvtsConf.get(t))||void 0===u?void 0:u.shouldQ))&&this._pEvtsQ.push({name:t,data:i}),!1;let c=[],f=!1;return this._evts[t].forEach((e=>{var s,n,o;let l=!1;if(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.buffered){null===(n=null==e?void 0:e.bucket)||void 0===n||n.push(i);const s=null!==(o=null==e?void 0:e.options.bufferCapacity)&&void 0!==o?o:this._opts.bufferCapacity;(null==e?void 0:e.bucket)&&e.bucket.length>=s&&(e.fn(e.bucket),_.call(this,t,e.bucket),l=!0,f=!0,this._opts.logger("emit",t,e.bucket),e.bucket=[])}else e.fn(i),_.call(this,t,i),l=!0,f=!0,this._opts.logger("emit",t,i);e.once&&l||c.push(e)})),this._evts[t]=c,f}on(t,e,s){if(this._evts[t]||(this._evts[t]=[]),-1!==u(this._evts[t],e,s))return!1;const i=new n(t,e,!1,s);return(null==s?void 0:s.control)instanceof f&&a.call(this,s.control,i),this._evts[t].push(i),this._opts.logger("on",t,e),!0}once(t,e,s){if(this._evts[t]||(this._evts[t]=[]),-1!==u(this._evts[t],e,s))return!1;const i=new n(t,e,!0,s);return(null==s?void 0:s.control)instanceof f&&a.call(this,s.control,i),this._evts[t].push(i),this._opts.logger("on",t,e),!0}off(t,e,s){let i=u(this._evts[t],e,s);return-1!==i&&(this._evts[t].splice(i,1),this._opts.logger("off",t,e),!0)}flush(t,e,s){let i=!1,n=[];return this._evts[t].forEach(((o,u)=>{var h;if((null===(h=null==o?void 0:o.options)||void 0===h?void 0:h.buffered)&&(null==o?void 0:o.bucket)&&o.bucket.length>0){const h=e&&e===o.fn,r=s&&l(s,o.options);(t&&h&&r||t&&!e&&!s)&&(o.fn(o.bucket),_.call(this,t,o.bucket),i=!0,this._opts.logger("emit",t,o.bucket),o.bucket=[],o.once&&n.push(u))}})),this._evts[t]=this._evts[t].filter(((t,e)=>!n.includes(e))),i}pause(i){var n,l;const u=null!==(n=null==i?void 0:i.queueEmissions)&&void 0!==n?n:t,h=null!==(l=null==i?void 0:i.emissionInterval)&&void 0!==l?l:0;"string"==typeof(null==i?void 0:i.eventName)?this._pEvtsConf.set(null==i?void 0:i.eventName,new o(null==i?void 0:i.eventName,s,u,h)):(this._pEvtsConf.size>1&&this._pEvtsConf.clear(),this._pEvtsConf.set(e,new o(e,s,u,h)))}resume(t){let i=[],n=0;if("string"==typeof t){if(this._pEvtsConf.get(t)){const{shouldQ:e,status:o,interval:l}=this._pEvtsConf.get(t).getProps();this._pEvtsConf.delete(t),o===s&&e&&(this._pEvtsQ=this._pEvtsQ.filter((e=>e.name!==t||(i.push(e),!1))),n=l)}}else if(this._pEvtsConf.size>1)n=0,i=this._pEvtsQ,this._pEvtsQ=[];else if(this._pEvtsConf.get(e)){const{shouldQ:t,status:o,interval:l}=this._pEvtsConf.get(e).getProps();this._pEvtsConf.clear(),o===s&&t&&(i=this._pEvtsQ,this._pEvtsQ=[],n=l)}if(n>0){return(()=>p(this,void 0,void 0,(function*(){for(const t of i)yield h.call(this,t,n)})))()}i.forEach((({name:t,data:e})=>{this.emit(t,e)}))}offAll(t){var e;return!!(t&&(null===(e=this._evts[t])||void 0===e?void 0:e.length)>0)&&(delete this._evts[t],this._pEvtsQ=this._pEvtsQ.filter((e=>e.name!==t)),this._pEvtsConf.delete(t),this._cache.delete(t),!0)}cleanup(){this._pEvtsConf.clear(),this._pEvtsQ=[],this._cache.clear(),this._evts={}}listeners(t){return void 0===t?this._evts:this._evts[t].map((t=>t.fn))}getCache(t){return this._cache.get(t)||[]}static enableDebug(t){!function(t){r=Object.assign(Object.assign({},r),t)}(t)}static get debugStatus(){return r}}function _(t,e){if(!this._opts.cache)return;const s=this._cache.get(t)||[];s.length>=this._opts.cacheCapacity&&s.shift(),s.push(e),this._cache.set(t,s)}d.prototype.addListener=d.prototype.on,d.prototype.removeListener=d.prototype.off;export{d as BufferedEventEmitter,f as EventController};
//# sourceMappingURL=bundle.esm.min.mjs.map
