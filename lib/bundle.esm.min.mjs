const t=!0,e=`__all-${Date.now()}`,s="0",i="1";class o{name;fn;once;options;bucket;bufferInactivityTimeoutId;constructor(t,e,s,i){this.name=t,this.fn=e,this.once=s,this.options=i,i?.buffered&&(this.bucket=[],this.bufferInactivityTimeoutId=void 0)}}class n{name;shouldQ;interval;status;constructor(t,e,s,i){this.name=t,this.status=e,this.shouldQ=s,this.interval=i}updateProps({status:t,shouldQ:e,interval:s}){t&&(this.status=t),void 0!==e&&(this.shouldQ=e),void 0!==s&&(this.interval=s)}getProps(){return{status:this.status,shouldQ:this.shouldQ,interval:this.interval,name:this.name}}}function f(t,e){if(t===e)return!0;if(!t||!e)return!1;const s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;let o;for(o in t)if(t[o]!==e[o])return!1;return!0}function u(t,e,s){for(let i=0;i<t.length;i++)if(t[i].fn===e&&f(t[i].options,s))return i;return-1}function c(t,e){let s;return new Promise((i=>s=setTimeout((()=>{this.emit(t.name,t.data),i(!0)}),e))).finally((()=>{clearTimeout(s)}))}let r={emit:!1,on:!1,off:!1};function h(t,e,s){if("emit"===t&&!r.emit||"on"===t&&!r.on||"off"===t&&!r.off)return;if("emit"===t)try{s=JSON.stringify(s)}catch{s=`Object with the following keys failed to stringify: ${Object.keys(s).join(",")}`}else["on","off"].includes(t)&&"function"==typeof s&&(s=s.toString());const i=new Date,o=`${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}.${i.getMilliseconds()}`;console.groupCollapsed(`%c[Event Type: ${t} | Event Name: ${e} | ${o}]`,"color: blue; font-size: 12px"),console.log(`%c[Event Data: ${s}}]`,"color: #AD5D4E; font-size: 11px"),console.groupEnd()}class a{flush(){}off(){}}const l=new Map;function v(t,e){const s=l.get(t)||[];s.push(e),l.set(t,s),t.off=()=>{s.forEach((t=>{this.off(t.name,t.fn,t.options)}))},t.flush=()=>{s.forEach((t=>{this.flush(t.name,t.fn,t.options)}))}}class p{_evts;_opts;_pEvtsConf;_pEvtsQ;_cache;constructor(s){this._evts={},this._opts={buffered:s?.buffered??false,bufferCapacity:s?.bufferCapacity??5,bufferInactivityTimeout:s?.bufferInactivityTimeout??0,logger:s?.logger??h,cache:s?.cache??false,cacheCapacity:s?.cacheCapacity??20},this._pEvtsConf=new Map([[e,new n(e,i,t,0)]]),this._pEvtsQ=[],this._cache=new Map}emit(t,i){if(!this._evts[t]||0===this._evts[t].length)return!1;const o=this._pEvtsConf.get(e)?.status===s,n=this._pEvtsConf.get(t)?.status===s;if(o||n)return(this._pEvtsConf.get(e)?.shouldQ||this._pEvtsConf.get(t)?.shouldQ)&&this._pEvtsQ.push({name:t,data:i}),!1;let f=[],u=!1;return[...this._evts[t]].forEach((e=>{let s=!1;if(e?.options?.buffered){e?.bucket?.push(i);const o=e?.options.bufferCapacity??this._opts.bufferCapacity;if(e?.bucket&&e.bucket.length>=o)e.bufferInactivityTimeoutId&&(clearTimeout(e.bufferInactivityTimeoutId),e.bufferInactivityTimeoutId=void 0),e.fn(e.bucket),_.call(this,t,e.bucket),s=!0,u=!0,this._opts.logger("emit",t,e.bucket),e.bucket=[];else if(e?.bucket&&e.bucket.length>0){const s=e?.options?.bufferInactivityTimeout??this._opts.bufferInactivityTimeout;s>0&&(e.bufferInactivityTimeoutId&&(clearTimeout(e.bufferInactivityTimeoutId),e.bufferInactivityTimeoutId=void 0),e.bufferInactivityTimeoutId=setTimeout((()=>{e?.bucket&&e.bucket.length&&(e.fn(e.bucket),_.call(this,t,e.bucket),this._opts.logger("emit",t,e.bucket),e.bucket=[]),e.bufferInactivityTimeoutId=void 0}),s))}}else e.fn(i),_.call(this,t,i),s=!0,u=!0,this._opts.logger("emit",t,i);e.once&&s&&f.push(e)})),this._evts[t]=this._evts?.[t]?.filter((t=>!f.includes(t)))??[],u}on(t,e,s){if(this._evts[t]||(this._evts[t]=[]),-1!==u(this._evts[t],e,s))return!1;const i=new o(t,e,!1,s);return s?.control instanceof a&&v.call(this,s.control,i),this._evts[t].push(i),this._opts.logger("on",t,e),!0}once(t,e,s){if(this._evts[t]||(this._evts[t]=[]),-1!==u(this._evts[t],e,s))return!1;const i=new o(t,e,!0,s);return s?.control instanceof a&&v.call(this,s.control,i),this._evts[t].push(i),this._opts.logger("on",t,e),!0}off(t,e,s){if(!this._evts[t]||0===this._evts[t].length)return!1;let i=u(this._evts[t],e,s);if(-1===i)return!1;const[o]=this._evts[t].splice(i,1);return o.bufferInactivityTimeoutId&&(clearTimeout(o.bufferInactivityTimeoutId),o.bufferInactivityTimeoutId=void 0),this._opts.logger("off",t,e),!0}flush(t,e,s){if(!this._evts[t]||0===this._evts[t].length)return!1;let i=!1,o=[];return[...this._evts[t]].forEach((n=>{if(n?.options?.buffered&&n?.bucket&&n.bucket.length>0){const u=e&&e===n.fn,c=s&&f(s,n.options);(u&&c||u&&!s||!e&&!s)&&(n.bufferInactivityTimeoutId&&(clearTimeout(n.bufferInactivityTimeoutId),n.bufferInactivityTimeoutId=void 0),n.fn(n.bucket),_.call(this,t,n.bucket),i=!0,this._opts.logger("emit",t,n.bucket),n.bucket=[],n.once&&o.push(n))}})),this._evts[t]=this._evts?.[t]?.filter((t=>!o.includes(t)))??[],i}pause(i){const o=i?.queueEmissions??t,f=i?.emissionInterval??0;"string"==typeof i?.eventName?this._pEvtsConf.set(i?.eventName,new n(i?.eventName,s,o,f)):(this._pEvtsConf.size>1&&this._pEvtsConf.clear(),this._pEvtsConf.set(e,new n(e,s,o,f)))}resume(t){let i=[],o=0;if("string"==typeof t){if(this._pEvtsConf.get(t)){const{shouldQ:e,status:n,interval:f}=this._pEvtsConf.get(t).getProps();this._pEvtsConf.delete(t),n===s&&e&&(this._pEvtsQ=this._pEvtsQ.filter((e=>e.name!==t||(i.push(e),!1))),o=f)}}else if(this._pEvtsConf.size>1)o=0,i=this._pEvtsQ,this._pEvtsQ=[];else if(this._pEvtsConf.get(e)){const{shouldQ:t,status:n,interval:f}=this._pEvtsConf.get(e).getProps();this._pEvtsConf.clear(),n===s&&t&&(i=this._pEvtsQ,this._pEvtsQ=[],o=f)}if(o>0){return(async()=>{for(const t of i)await c.call(this,t,o)})()}i.forEach((({name:t,data:e})=>{this.emit(t,e)}))}offAll(t){if(t&&this._evts[t]?.length>0){return this._evts[t].forEach((t=>{t.bufferInactivityTimeoutId&&(clearTimeout(t.bufferInactivityTimeoutId),t.bufferInactivityTimeoutId=void 0)})),delete this._evts[t],this._pEvtsQ=this._pEvtsQ.filter((e=>e.name!==t)),this._pEvtsConf.delete(t),this._cache.delete(t),!0}return!1}cleanup(){this._pEvtsConf.clear(),this._pEvtsQ=[],this._cache.clear(),Object.values(this._evts).forEach((t=>{t.forEach((t=>{t.bufferInactivityTimeoutId&&(clearTimeout(t.bufferInactivityTimeoutId),t.bufferInactivityTimeoutId=void 0)}))})),this._evts={}}listeners(t){return void 0===t?this._evts:this._evts[t]?this._evts[t].map((t=>t.fn)):[]}getCache(t){return this._cache.get(t)||[]}static enableDebug(t){!function(t){r={...r,...t}}(t)}static get debugStatus(){return r}}function _(t,e){if(!this._opts.cache)return;const s=this._cache.get(t)||[];s.length>=this._opts.cacheCapacity&&s.shift(),s.push(e),this._cache.set(t,s)}p.prototype.addListener=p.prototype.on,p.prototype.removeListener=p.prototype.off;export{p as BufferedEventEmitter,a as EventController};
//# sourceMappingURL=bundle.esm.min.mjs.map
