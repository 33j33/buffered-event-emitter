class t{constructor(t,e,n,s){this.name=t,this.fn=e,this.once=n,this.options=s,(null==s?void 0:s.buffered)&&(this.bucket=[],this.timeoutID=void 0)}}class e{flush(){}off(){}}function n(t,e){if(t===e)return!0;if(!t||!e)return!1;const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;let i;for(i in t)if(t[i]!==e[i])return!1;return!0}function s(t,e,s){for(let i=0;i<t.length;i++)if(t[i].fn===e&&n(t[i].options,s))return i;return-1}function i(t,e){let n;return new Promise((s=>n=setTimeout((()=>{this.emit(t.eventName,t.data),s(!0)}),e))).finally((()=>{clearTimeout(n)}))}function o(t,e,n){if("emit"===t&&!f.debugStatus.emit||"on"===t&&!f.debugStatus.on||"off"===t&&!f.debugStatus.off)return;if("emit"===t)try{n=JSON.stringify(n)}catch(t){n=`Object with the following keys failed to stringify: ${Object.keys(n).join(",")}`}else["on","off"].includes(t)&&"function"==typeof n&&(n=n.toString());const s=new Date,i=`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}.${s.getMilliseconds()}`;console.groupCollapsed(`%c[Event Type: ${t} | Event Name: ${e} | ${i}]`,"color: blue; font-size: 12px"),console.log(`%c[Event Data: ${n}}]`,"color: #AD5D4E; font-size: 11px"),console.groupEnd()}const u=new Map;function l(t,e){const n=u.get(t)||[];n.push(e),u.set(t,n),t.off=()=>{n.forEach((t=>{this.off(t.name,t.fn,t.options)}))},t.flush=()=>{n.forEach((t=>{this.flush(t.name,t.fn,t.options)}))}}var r=function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function u(t){try{r(s.next(t))}catch(t){o(t)}}function l(t){try{r(s.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,l)}r((s=s.apply(t,e||[])).next())}))};class f{constructor(t){var e,n,s;this._events={},this._options={buffered:null!==(e=null==t?void 0:t.buffered)&&void 0!==e&&e,bufferCapacity:null!==(n=null==t?void 0:t.bufferCapacity)&&void 0!==n?n:5,logger:null!==(s=null==t?void 0:t.logger)&&void 0!==s?s:o},this._status="emitting",this._queueEmissions=!0,this._emissionInterval=0,this._queue=[]}emit(t,e){if(!this._events[t]||0===this._events[t].length)return!1;if("paused"===this._status)return this._queueEmissions&&this._queue.push({eventName:t,data:e}),!1;let n=[],s=!1;return this._events[t].forEach((i=>{var o,u,l;let r=!1;if(null===(o=null==i?void 0:i.options)||void 0===o?void 0:o.buffered){null===(u=null==i?void 0:i.bucket)||void 0===u||u.push(e);const n=null!==(l=null==i?void 0:i.options.bufferCapacity)&&void 0!==l?l:this._options.bufferCapacity;(null==i?void 0:i.bucket)&&i.bucket.length>=n&&(i.fn(i.bucket),r=!0,s=!0,this._options.logger("emit",t,i.bucket),i.bucket=[])}else i.fn(e),r=!0,s=!0,this._options.logger("emit",t,e);i.once&&r||n.push(i)})),this._events[t]=n,s}on(n,i,o){if(this._events[n]||(this._events[n]=[]),-1!==s(this._events[n],i,o))return!1;const u=new t(n,i,!1,o);return(null==o?void 0:o.control)instanceof e&&l.call(this,o.control,u),this._events[n].push(u),this._options.logger("on",n,i),!0}once(n,i,o){if(this._events[n]||(this._events[n]=[]),-1!==s(this._events[n],i,o))return!1;const u=new t(n,i,!0,o);return(null==o?void 0:o.control)instanceof e&&l.call(this,o.control,u),this._events[n].push(u),this._options.logger("on",n,i),!0}off(t,e,n){let i=s(this._events[t],e,n);return-1!==i&&(this._events[t].splice(i,1),this._options.logger("off",t,e),!0)}flush(t,e,s){let i=!1,o=[];return this._events[t].forEach(((u,l)=>{var r;if((null===(r=null==u?void 0:u.options)||void 0===r?void 0:r.buffered)&&(null==u?void 0:u.bucket)&&u.bucket.length>0){const r=e&&e===u.fn,f=s&&n(s,u.options);(t&&r&&f||t&&!e&&!s)&&(u.fn(u.bucket),i=!0,this._options.logger("emit",t,u.bucket),u.bucket=[],u.once&&o.push(l))}})),this._events[t]=this._events[t].filter(((t,e)=>!o.includes(e))),i}pause(t=!0,e=0){this._queueEmissions=t,this._emissionInterval=e,this._status="paused"}resume(){if(this._status="emitting",this._queueEmissions){if(this._emissionInterval>0){return(()=>r(this,void 0,void 0,(function*(){for(const t of this._queue)yield i.call(this,t,this._emissionInterval)})))()}this._queue.forEach((({eventName:t,data:e})=>{this.emit(t,e)})),this._queue=[]}}offAll(t){var e;return!!(t&&(null===(e=this._events[t])||void 0===e?void 0:e.length)>0)&&(delete this._events[t],this._queue=this._queue.filter((e=>e.eventName!==t)),!0)}cleanup(){this._queue=[],this._events={}}listeners(t){return void 0===t?this._events:this._events[t].map((t=>t.fn))}static enableDebug(t){f.debugStatus=Object.assign(Object.assign({},f.debugStatus),t)}}f.debugStatus={emit:!1,on:!1,off:!1},f.prototype.addListener=f.prototype.on,f.prototype.removeListener=f.prototype.off;export{f as BufferedEventEmitter,e as EventController};
//# sourceMappingURL=bundle.esm.min.mjs.map
